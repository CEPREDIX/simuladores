<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Evaluaci√≥n Historia de M√©xico - CEPREDIX</title>
    <style>
        :root {
            --primary: #1a5276; /* Azul oscuro institucional */
            --secondary: #d35400; /* Terracota */
            --accent: #27ae60;    /* Verde acierto */
            --error: #c0392b;     /* Rojo error */
            --bg: #fdfefe;
            --text: #2c3e50;
        }

        body {
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            background-color: var(--bg);
            color: var(--text);
            margin: 0;
            display: flex;
            flex-direction: column;
            min-height: 100vh;
        }

        header {
            background-color: var(--primary);
            color: white;
            padding: 1.5rem;
            text-align: center;
            box-shadow: 0 4px 6px rgba(0,0,0,0.1);
        }

        nav {
            display: flex;
            justify-content: center;
            gap: 15px;
            padding: 1rem;
            flex-wrap: wrap;
            background: #ecf0f1;
            border-bottom: 2px solid #bdc3c7;
        }

        button {
            padding: 10px 20px;
            border: none;
            border-radius: 6px;
            cursor: pointer;
            font-weight: bold;
            font-size: 1rem;
            transition: all 0.2s;
            background-color: white;
            color: var(--primary);
            border: 2px solid var(--primary);
        }

        button:hover {
            transform: translateY(-2px);
            background-color: var(--primary);
            color: white;
        }

        button.active {
            background-color: var(--secondary);
            color: white;
            border-color: var(--secondary);
        }

        main {
            flex: 1;
            padding: 20px;
            max-width: 1000px;
            margin: 0 auto;
            width: 100%;
        }

        .section { display: none; animation: fadeIn 0.5s; }
        .section.active { display: block; }

        @keyframes fadeIn { from { opacity: 0; } to { opacity: 1; } }

        /* --- SCOREBOARD GENERAL --- */
        .scoreboard {
            background: white;
            padding: 15px;
            border-radius: 8px;
            box-shadow: 0 2px 10px rgba(0,0,0,0.1);
            margin-bottom: 20px;
            display: flex;
            justify-content: space-around;
            align-items: center;
            font-weight: bold;
            font-size: 1.1rem;
        }
        
        .score-item span { display: block; font-size: 0.8rem; color: #7f8c8d; }
        .score-val { font-size: 1.5rem; color: var(--secondary); }

        /* --- QUIZ L√çNEA DE TIEMPO --- */
        .quiz-container {
            background: white;
            padding: 30px;
            border-radius: 10px;
            text-align: center;
            box-shadow: 0 4px 15px rgba(0,0,0,0.05);
        }
        
        .quiz-options {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 15px;
            margin-top: 20px;
        }

        .btn-option {
            background: #f8f9fa;
            border: 2px solid #bdc3c7;
            padding: 15px;
            font-size: 1.2rem;
            color: var(--text);
        }

        .btn-option:hover { background: #eef2f3; }
        
        .btn-option.correct { background: var(--accent); color: white; border-color: var(--accent); }
        .btn-option.wrong { background: var(--error); color: white; border-color: var(--error); }

        /* --- FLASHCARDS --- */
        .flashcard-container {
            perspective: 1000px;
            width: 100%;
            max-width: 600px;
            height: 300px;
            margin: 20px auto;
            cursor: pointer;
        }

        .flashcard {
            width: 100%;
            height: 100%;
            position: relative;
            transform-style: preserve-3d;
            transition: transform 0.6s;
            box-shadow: 0 8px 16px rgba(0,0,0,0.1);
            border-radius: 15px;
        }

        .flashcard.flipped { transform: rotateY(180deg); }

        .front, .back {
            position: absolute;
            width: 100%;
            height: 100%;
            backface-visibility: hidden;
            display: flex;
            flex-direction: column;
            align-items: center;
            justify-content: center;
            padding: 20px;
            box-sizing: border-box;
            border-radius: 15px;
            text-align: center;
            border: 1px solid #eee;
        }

        .front { background: white; color: var(--primary); border-top: 5px solid var(--primary); }
        .back { background: #fdfefe; color: var(--text); transform: rotateY(180deg); border-top: 5px solid var(--secondary); }

        .evaluation-btns {
            display: flex;
            justify-content: center;
            gap: 20px;
            margin-top: 20px;
            visibility: hidden; /* Oculto hasta voltear */
        }
        
        .btn-eval { width: 150px; }
        .btn-know { border-color: var(--accent); color: var(--accent); }
        .btn-know:hover { background: var(--accent); color: white; }
        .btn-dont { border-color: var(--error); color: var(--error); }
        .btn-dont:hover { background: var(--error); color: white; }

        /* --- MEMORAMA --- */
        .memory-grid {
            display: grid;
            grid-template-columns: repeat(auto-fill, minmax(140px, 1fr));
            gap: 10px;
            margin-top: 20px;
        }

        .memory-card {
            background-color: var(--primary);
            color: transparent;
            height: 100px;
            display: flex;
            align-items: center;
            justify-content: center;
            border-radius: 8px;
            cursor: pointer;
            transition: transform 0.3s;
            text-align: center;
            padding: 5px;
            font-size: 0.85rem;
            user-select: none;
            box-shadow: 0 2px 5px rgba(0,0,0,0.2);
        }

        .memory-card.revealed {
            background-color: white;
            color: var(--text);
            border: 2px solid var(--secondary);
            transform: rotateY(0);
        }

        .memory-card.matched {
            background-color: var(--accent);
            color: white;
            border-color: var(--accent);
            cursor: default;
        }

        .tag {
            display: inline-block;
            padding: 4px 8px;
            border-radius: 4px;
            font-size: 0.8rem;
            margin-bottom: 10px;
            color: white;
        }
        .tag-pres { background: #2980b9; }
        .tag-plan { background: #c0392b; }
        .tag-trat { background: #8e44ad; }
        .tag-const { background: #f39c12; color: black; }

        /* Utilidad */
        .hidden { display: none; }
        .fade-in { animation: fadeIn 0.5s; }

    </style>
</head>
<body>

<header>
    <h1>üá≤üáΩ Historia de M√©xico: Suite de Evaluaci√≥n</h1>
    <p>Domina los Pactos, Planes y Presidentes (CEPREDIX)</p>
</header>

<nav>
    <button onclick="switchMode('timeline')" id="btn-timeline">üìÖ Quiz Cronol√≥gico</button>
    <button onclick="switchMode('flashcards')" id="btn-flashcards">üÉè Flashcards (Repaso)</button>
    <button onclick="switchMode('memory')" id="btn-memory">üß† Memorama (Reto)</button>
</nav>

<main>
    <div id="timeline" class="section active">
        <div class="scoreboard">
            <div class="score-item"><span>Aciertos</span><div class="score-val" id="tl-score">0</div></div>
            <div class="score-item"><span>Pregunta</span><div class="score-val"><span id="tl-current">1</span>/<span id="tl-total">10</span></div></div>
            <div class="score-item"><span>Calificaci√≥n</span><div class="score-val" id="tl-grade">0%</div></div>
        </div>

        <div id="quiz-start" style="text-align: center;">
            <h2>Desaf√≠o Cronol√≥gico</h2>
            <p>Se te presentar√° un evento hist√≥rico. Debes seleccionar el a√±o correcto.</p>
            <button onclick="startTimelineQuiz()" style="margin-top: 20px; font-size: 1.2rem;">üöÄ Iniciar Examen</button>
        </div>

        <div id="quiz-game" class="quiz-container hidden">
            <span id="quiz-tag" class="tag">Categor√≠a</span>
            <h2 id="quiz-question">¬øPregunta?</h2>
            <p id="quiz-desc" style="color: #666; margin-bottom: 20px;">Detalle...</p>
            <div class="quiz-options" id="quiz-options">
                </div>
            <div id="quiz-feedback" style="margin-top: 15px; font-weight: bold; height: 20px;"></div>
        </div>

        <div id="quiz-end" class="hidden" style="text-align: center;">
            <h2>¬°Examen Terminado!</h2>
            <p id="quiz-final-msg">Resumen de resultados...</p>
            <button onclick="startTimelineQuiz()">üîÑ Reintentar</button>
        </div>
    </div>

    <div id="flashcards" class="section">
        <div class="scoreboard">
            <div class="score-item"><span>Dominadas (Bien)</span><div class="score-val" style="color: var(--accent);" id="fc-correct">0</div></div>
            <div class="score-item"><span>Por Repasar (Mal)</span><div class="score-val" style="color: var(--error);" id="fc-wrong">0</div></div>
            <div class="score-item"><span>Progreso</span><div class="score-val" id="fc-progress">0%</div></div>
        </div>
        
        <p style="text-align: center; color: #7f8c8d;">Piensa la respuesta, voltea la tarjeta y calif√≠cate honestamente.</p>

        <div class="flashcard-container" onclick="flipCard()">
            <div class="flashcard" id="card">
                <div class="front">
                    <span id="card-category" class="tag tag-pres">Categor√≠a</span>
                    <h3 id="card-front-text">Concepto</h3>
                    <p style="font-size: 0.8rem; margin-top: 20px;">(Clic para ver respuesta)</p>
                </div>
                <div class="back">
                    <h3 id="card-back-title">A√±o - Respuesta</h3>
                    <p id="card-back-text">Descripci√≥n...</p>
                </div>
            </div>
        </div>

        <div class="evaluation-btns" id="eval-buttons">
            <button class="btn-eval btn-dont" onclick="rateCard(false)">‚ùå No la sab√≠a</button>
            <button class="btn-eval btn-know" onclick="rateCard(true)">‚úÖ La sab√≠a</button>
        </div>
    </div>

    <div id="memory" class="section">
        <div class="scoreboard">
            <div class="score-item"><span>Tiempo</span><div class="score-val" id="mem-time">00:00</div></div>
            <div class="score-item"><span>Intentos</span><div class="score-val" id="mem-moves">0</div></div>
            <div class="score-item"><span>Pares Restantes</span><div class="score-val" id="mem-pairs">8</div></div>
        </div>

        <div id="memory-start" style="text-align: center; margin-bottom: 20px;">
            <button onclick="initMemory()">üîÑ Reiniciar / Barajar</button>
        </div>

        <div class="memory-grid" id="memory-board">
            </div>
    </div>
</main>

<script>
    /* --- DATOS EXTRA√çDOS DEL PDF --- */
    const rawData = [
        { type: 'pres', year: 1824, title: "Guadalupe Victoria", desc: "1er Presidente. Rep√∫blica Federal.", details: "Complet√≥ su periodo. Constituci√≥n de 1824." },
        { type: 'pres', year: 1829, title: "Vicente Guerrero", desc: "Abolici√≥n de la esclavitud.", details: "Derrocado y fusilado. Insurgente clave." },
        { type: 'pres', year: 1833, title: "Antonio L√≥pez de Santa Anna", desc: "Presidente 11 veces.", details: "Guerra de Texas y p√©rdida de territorio vs EE.UU." },
        { type: 'const', year: 1836, title: "Las Siete Leyes", desc: "Constituci√≥n Centralista.", details: "Elimina estados por departamentos. Causa independencia de Texas." },
        { type: 'trat', year: 1848, title: "Tratado Guadalupe Hidalgo", desc: "M√©xico pierde la mitad del territorio.", details: "Fin guerra con EE.UU. Frontera en R√≠o Bravo." },
        { type: 'plan', year: 1854, title: "Plan de Ayutla", desc: "Derrocar a Santa Anna.", details: "Inicio de la era Liberal. Juan √Ålvarez e Ignacio Comonfort." },
        { type: 'const', year: 1857, title: "Constituci√≥n de 1857", desc: "Constituci√≥n Liberal.", details: "Garant√≠as individuales. Causa Guerra de Reforma." },
        { type: 'pres', year: 1858, title: "Benito Ju√°rez", desc: "Leyes de Reforma.", details: "Separaci√≥n Iglesia-Estado. Gobierno itinerante." },
        { type: 'trat', year: 1864, title: "Tratados de Miramar", desc: "Maximiliano Emperador.", details: "Apoyo franc√©s para establecer el Segundo Imperio." },
        { type: 'pres', year: 1872, title: "Sebasti√°n Lerdo de Tejada", desc: "Sucesor de Ju√°rez.", details: "Restauraci√≥n de la Rep√∫blica. Derrocado por D√≠az." },
        { type: 'plan', year: 1876, title: "Plan de Tuxtepec", desc: "Porfirio D√≠az contra la reelecci√≥n.", details: "'Sufragio efectivo, no reelecci√≥n'. Inicia Porfiriato." },
        { type: 'pres', year: 1877, title: "Porfirio D√≠az", desc: "El Porfiriato (30 a√±os).", details: "Orden y Progreso. Paz Porfiriana. Desigualdad social." },
        { type: 'plan', year: 1910, title: "Plan de San Luis", desc: "Madero inicia la Revoluci√≥n.", details: "20 de Noviembre. Desconoce elecciones de D√≠az." },
        { type: 'plan', year: 1911, title: "Plan de Ayala", desc: "Zapata exige tierras.", details: "'Tierra y Libertad'. Contra Madero por no cumplir promesas." },
        { type: 'pres', year: 1913, title: "Victoriano Huerta", desc: "El Usurpador.", details: "Decena Tr√°gica. Asesinato de Madero." },
        { type: 'plan', year: 1913, title: "Plan de Guadalupe", desc: "Carranza contra Huerta.", details: "Creaci√≥n del Ej√©rcito Constitucionalista." },
        { type: 'const', year: 1917, title: "Constituci√≥n de 1917", desc: "Derechos Sociales (Art 3, 27, 123).", details: "Promulgada por Carranza en Quer√©taro." },
        { type: 'pres', year: 1920, title: "√Ålvaro Obreg√≥n", desc: "Caudillo invicto.", details: "Tratados de Bucareli. Reconstrucci√≥n nacional." },
        { type: 'pres', year: 1924, title: "Plutarco El√≠as Calles", desc: "Maximato y fundaci√≥n del PNR.", details: "Guerra Cristera. 'Jefe M√°ximo'." },
        { type: 'pres', year: 1934, title: "L√°zaro C√°rdenas", desc: "Expropiaci√≥n Petrolera.", details: "Reparto agrario masivo. Educaci√≥n Socialista. IPN." },
        { type: 'pres', year: 1940, title: "√Åvila Camacho", desc: "Unidad Nacional.", details: "2da Guerra Mundial. Creaci√≥n del IMSS." },
        { type: 'pres', year: 1946, title: "Miguel Alem√°n", desc: "Industrializaci√≥n y Civilismo.", details: "Ciudad Universitaria. Turismo." },
        { type: 'pres', year: 1952, title: "Ruiz Cortines", desc: "Voto de la Mujer (1953).", details: "Austeridad y moralizaci√≥n." },
        { type: 'pres', year: 1958, title: "L√≥pez Mateos", desc: "Nacionalizaci√≥n el√©ctrica.", details: "Libros de texto gratuitos. ISSSTE." },
        { type: 'pres', year: 1964, title: "D√≠az Ordaz", desc: "Matanza de Tlatelolco (68).", details: "Juegos Ol√≠mpicos. Tratado de Tlatelolco." },
        { type: 'pres', year: 1970, title: "Luis Echeverr√≠a", desc: "Guerra Sucia y Halconazo.", details: "Populismo y crisis econ√≥mica." },
        { type: 'pres', year: 1976, title: "L√≥pez Portillo", desc: "Nacionalizaci√≥n de la Banca.", details: "Petrolizaci√≥n de la econom√≠a. 'Defender el peso como perro'." },
        { type: 'pres', year: 1982, title: "Miguel de la Madrid", desc: "Inicio del Neoliberalismo.", details: "Sismo de 1985. Renovaci√≥n Moral." },
        { type: 'trat', year: 1986, title: "Ingreso al GATT", desc: "Apertura comercial.", details: "Fin del proteccionismo." },
        { type: 'pres', year: 1988, title: "Carlos Salinas", desc: "Firma del TLCAN.", details: "Privatizaciones. Levantamiento EZLN." },
        { type: 'pres', year: 1994, title: "Ernesto Zedillo", desc: "Error de Diciembre.", details: "FOBAPROA. Autonom√≠a del IFE." },
        { type: 'pres', year: 2000, title: "Vicente Fox", desc: "Alternancia (PAN).", details: "Fin de 71 a√±os del PRI." },
        { type: 'pres', year: 2006, title: "Felipe Calder√≥n", desc: "Guerra contra el Narco.", details: "Violencia e inseguridad." },
        { type: 'pres', year: 2012, title: "Enrique Pe√±a Nieto", desc: "Pacto por M√©xico.", details: "Reformas Estructurales. Ayotzinapa." },
        { type: 'pres', year: 2018, title: "L√≥pez Obrador", desc: "Cuarta Transformaci√≥n.", details: "Tren Maya. Programas sociales. MORENA." }
    ];

    /* --- GESTI√ìN DE PESTA√ëAS --- */
    function switchMode(modeId) {
        document.querySelectorAll('.section').forEach(el => el.classList.remove('active'));
        document.querySelectorAll('nav button').forEach(el => el.classList.remove('active'));
        
        document.getElementById(modeId).classList.add('active');
        document.getElementById('btn-' + modeId).classList.add('active');

        if(modeId === 'timeline') resetQuizUI();
        if(modeId === 'flashcards') loadNextFlashcard();
        if(modeId === 'memory') initMemory();
    }

    /* =========================================
       L√ìGICA: QUIZ DE L√çNEA DE TIEMPO
       ========================================= */
    let quizState = {
        questions: [],
        currentIdx: 0,
        score: 0
    };

    function resetQuizUI() {
        document.getElementById('quiz-start').classList.remove('hidden');
        document.getElementById('quiz-game').classList.add('hidden');
        document.getElementById('quiz-end').classList.add('hidden');
        document.getElementById('tl-score').innerText = '0';
        document.getElementById('tl-current').innerText = '0';
        document.getElementById('tl-grade').innerText = '0%';
    }

    function startTimelineQuiz() {
        // Seleccionar 10 preguntas aleatorias
        quizState.questions = [...rawData].sort(() => 0.5 - Math.random()).slice(0, 10);
        quizState.currentIdx = 0;
        quizState.score = 0;
        
        document.getElementById('quiz-start').classList.add('hidden');
        document.getElementById('quiz-end').classList.add('hidden');
        document.getElementById('quiz-game').classList.remove('hidden');
        document.getElementById('tl-total').innerText = quizState.questions.length;
        
        loadQuizQuestion();
    }

    function loadQuizQuestion() {
        const q = quizState.questions[quizState.currentIdx];
        
        // Actualizar UI
        document.getElementById('tl-current').innerText = quizState.currentIdx + 1;
        document.getElementById('quiz-question').innerText = q.title;
        document.getElementById('quiz-desc').innerText = q.desc;
        document.getElementById('quiz-feedback').innerText = "";
        
        // Tags
        const tagMap = { pres: 'Presidente', plan: 'Plan', trat: 'Tratado', const: 'Constituci√≥n' };
        const colorMap = { pres: 'tag-pres', plan: 'tag-plan', trat: 'tag-trat', const: 'tag-const' };
        const tagEl = document.getElementById('quiz-tag');
        tagEl.innerText = tagMap[q.type];
        tagEl.className = `tag ${colorMap[q.type]}`;

        // Generar Opciones (1 correcta + 3 distractores)
        let options = [q.year];
        while(options.length < 4) {
            let randomItem = rawData[Math.floor(Math.random() * rawData.length)];
            // Evitar duplicados y a√±os muy cercanos si es posible (opcional)
            if(!options.includes(randomItem.year)) {
                options.push(randomItem.year);
            }
        }
        options.sort(() => 0.5 - Math.random()); // Barajar opciones

        const optContainer = document.getElementById('quiz-options');
        optContainer.innerHTML = '';

        options.forEach(year => {
            const btn = document.createElement('button');
            btn.className = 'btn-option';
            btn.innerText = year;
            btn.onclick = () => checkQuizAnswer(btn, year, q.year);
            optContainer.appendChild(btn);
        });
    }

    function checkQuizAnswer(btnElement, selectedYear, correctYear) {
        // Deshabilitar todos los botones
        const btns = document.querySelectorAll('.btn-option');
        btns.forEach(b => b.disabled = true);

        const feedback = document.getElementById('quiz-feedback');

        if(selectedYear === correctYear) {
            btnElement.classList.add('correct');
            feedback.innerText = "¬°Correcto! üéâ";
            feedback.style.color = "var(--accent)";
            quizState.score++;
        } else {
            btnElement.classList.add('wrong');
            // Resaltar la correcta
            btns.forEach(b => {
                if(parseInt(b.innerText) === correctYear) b.classList.add('correct');
            });
            feedback.innerText = `Incorrecto. Era ${correctYear} üòì`;
            feedback.style.color = "var(--error)";
        }

        // Actualizar scoreboard
        document.getElementById('tl-score').innerText = quizState.score;
        const percentage = Math.round((quizState.score / (quizState.currentIdx + 1)) * 100);
        document.getElementById('tl-grade').innerText = percentage + "%";

        // Siguiente pregunta despu√©s de 1.5s
        setTimeout(() => {
            quizState.currentIdx++;
            if(quizState.currentIdx < quizState.questions.length) {
                loadQuizQuestion();
            } else {
                finishQuiz();
            }
        }, 1500);
    }

    function finishQuiz() {
        document.getElementById('quiz-game').classList.add('hidden');
        document.getElementById('quiz-end').classList.remove('hidden');
        const finalGrade = Math.round((quizState.score / quizState.questions.length) * 100);
        let msg = "";
        if(finalGrade === 100) msg = "¬°Perfecci√≥n Hist√≥rica! üèÜ";
        else if(finalGrade >= 80) msg = "¬°Excelente trabajo! ü•á";
        else if(finalGrade >= 60) msg = "Aprobado, pero repasa un poco. üìö";
        else msg = "Necesitas estudiar m√°s. ¬°Int√©ntalo de nuevo! üí™";
        
        document.getElementById('quiz-final-msg').innerHTML = `Obtuviste <b>${finalGrade}%</b>.<br>${msg}`;
    }

    /* =========================================
       L√ìGICA: FLASHCARDS (ANKI STYLE)
       ========================================= */
    let fcState = {
        deck: [],
        currentIdx: 0,
        correct: 0,
        wrong: 0
    };

    // Inicializar Deck aleatorio
    fcState.deck = [...rawData].sort(() => 0.5 - Math.random());

    function loadNextFlashcard() {
        const cardEl = document.getElementById('card');
        const btnsEl = document.getElementById('eval-buttons');
        
        // Reset visual
        cardEl.classList.remove('flipped');
        btnsEl.style.visibility = 'hidden';

        // Si se acaba el deck, rebarajar
        if(fcState.currentIdx >= fcState.deck.length) {
            fcState.deck = [...rawData].sort(() => 0.5 - Math.random());
            fcState.currentIdx = 0;
            alert("¬°Has repasado todas las tarjetas! Se reinicia la baraja.");
        }

        const item = fcState.deck[fcState.currentIdx];

        // Llenar contenido
        setTimeout(() => {
            document.getElementById('card-front-text').innerText = item.title;
            
            const tagMap = { pres: 'Personaje', plan: 'Plan', trat: 'Tratado', const: 'Constituci√≥n' };
            const colorMap = { pres: 'tag-pres', plan: 'tag-plan', trat: 'tag-trat', const: 'tag-const' };
            const tagEl = document.getElementById('card-category');
            tagEl.innerText = tagMap[item.type];
            tagEl.className = `tag ${colorMap[item.type]}`;

            document.getElementById('card-back-title').innerText = `${item.year} - ${item.desc}`;
            document.getElementById('card-back-text').innerText = item.details;
        }, 200);
    }

    function flipCard() {
        const cardEl = document.getElementById('card');
        if(!cardEl.classList.contains('flipped')) {
            cardEl.classList.add('flipped');
            document.getElementById('eval-buttons').style.visibility = 'visible';
        }
    }

    function rateCard(isKnown) {
        if(isKnown) {
            fcState.correct++;
            document.getElementById('fc-correct').innerText = fcState.correct;
        } else {
            fcState.wrong++;
            document.getElementById('fc-wrong').innerText = fcState.wrong;
            // Opcional: Si no la sabe, empujarla al final del deck para que vuelva a salir
            fcState.deck.push(fcState.deck[fcState.currentIdx]);
        }
        
        // Calcular progreso
        const total = fcState.correct + fcState.wrong;
        const grade = Math.round((fcState.correct / total) * 100);
        document.getElementById('fc-progress').innerText = grade + "%";

        // Siguiente
        fcState.currentIdx++;
        loadNextFlashcard();
    }

    /* =========================================
       L√ìGICA: MEMORAMA (CON TIMER)
       ========================================= */
    let memState = {
        cards: [],
        hasFlipped: false,
        lockBoard: false,
        firstCard: null,
        secondCard: null,
        matches: 0,
        moves: 0,
        startTime: null,
        timerInterval: null,
        totalPairs: 8
    };

    function initMemory() {
        // Reset variables
        memState.hasFlipped = false;
        memState.lockBoard = false;
        memState.firstCard = null;
        memState.secondCard = null;
        memState.matches = 0;
        memState.moves = 0;
        clearInterval(memState.timerInterval);
        memState.timerInterval = null;
        
        // Reset UI
        document.getElementById('mem-time').innerText = "00:00";
        document.getElementById('mem-moves').innerText = "0";
        document.getElementById('mem-pairs').innerText = memState.totalPairs;
        const board = document.getElementById('memory-board');
        board.innerHTML = '';

        // Crear Mazo (8 pares)
        const shuffledData = [...rawData].sort(() => 0.5 - Math.random()).slice(0, memState.totalPairs);
        let deck = [];
        shuffledData.forEach(item => {
            deck.push({ id: item.title, text: item.title, type: 'name' });
            deck.push({ id: item.title, text: item.desc, type: 'desc' });
        });
        deck.sort(() => 0.5 - Math.random());

        // Renderizar
        deck.forEach(cardItem => {
            const card = document.createElement('div');
            card.classList.add('memory-card');
            card.dataset.framework = cardItem.id;
            card.innerHTML = "?";
            
            // Guardamos contenido para mostrar al click
            card.dataset.content = cardItem.text;

            card.addEventListener('click', flipMemoryCard);
            board.appendChild(card);
        });
    }

    function startMemTimer() {
        memState.startTime = Date.now();
        memState.timerInterval = setInterval(() => {
            const delta = Math.floor((Date.now() - memState.startTime) / 1000);
            const mins = Math.floor(delta / 60).toString().padStart(2, '0');
            const secs = (delta % 60).toString().padStart(2, '0');
            document.getElementById('mem-time').innerText = `${mins}:${secs}`;
        }, 1000);
    }

    function flipMemoryCard() {
        if (memState.lockBoard) return;
        if (this === memState.firstCard) return;

        // Iniciar timer en el primer click
        if(!memState.timerInterval) startMemTimer();

        this.classList.add('revealed');
        this.innerText = this.dataset.content;
        
        // Ajustar fuente si el texto es largo
        this.style.fontSize = this.dataset.content.length > 25 ? '0.7rem' : '0.85rem';

        if (!memState.hasFlipped) {
            memState.hasFlipped = true;
            memState.firstCard = this;
            return;
        }

        memState.secondCard = this;
        memState.moves++;
        document.getElementById('mem-moves').innerText = memState.moves;
        checkForMatch();
    }

    function checkForMatch() {
        let isMatch = memState.firstCard.dataset.framework === memState.secondCard.dataset.framework;

        if (isMatch) {
            disableCards();
        } else {
            unflipCards();
        }
    }

    function disableCards() {
        memState.firstCard.classList.add('matched');
        memState.secondCard.classList.add('matched');
        
        memState.matches++;
        document.getElementById('mem-pairs').innerText = memState.totalPairs - memState.matches;

        resetBoard();

        if(memState.matches === memState.totalPairs) {
            clearInterval(memState.timerInterval);
            setTimeout(() => alert(`¬°Juego Terminado! \nTiempo: ${document.getElementById('mem-time').innerText}\nIntentos: ${memState.moves}`), 500);
        }
    }

    function unflipCards() {
        memState.lockBoard = true;
        setTimeout(() => {
            memState.firstCard.classList.remove('revealed');
            memState.secondCard.classList.remove('revealed');
            memState.firstCard.innerText = "?";
            memState.secondCard.innerText = "?";
            resetBoard();
        }, 1200);
    }

    function resetBoard() {
        [memState.hasFlipped, memState.lockBoard] = [false, false];
        [memState.firstCard, memState.secondCard] = [null, null];
    }

    // Inicializar
    switchMode('timeline'); // Inicia en timeline
</script>

</body>
</html>
